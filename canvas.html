<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Design - Infinite Canvas">
    <title>Untitled Project - AI Design</title>
    <link rel="icon" href="assets/images/logo.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="canvas.css?v=11">
</head>

<body class="canvas-mode">
    <!-- Unregister Service Worker on canvas page to prevent data URL interception crashes -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                registrations.forEach(function (r) { r.unregister(); });
            });
        }
    </script>
    <!-- Main Canvas Area (Full Viewport) -->
    <main class="canvas-area" id="main-canvas">
        <canvas id="infinite-canvas"></canvas>
    </main>

    <!-- Top Bar with Project Menu (Embedded in Canvas) -->
    <header class="top-bar">
        <!-- Logo and Project Menu -->
        <div class="left-section">
            <button class="logo-menu-btn" id="logo-btn">
                <img src="assets/images/logo.png" alt="AI Design" class="logo">
                <svg class="dropdown-arrow" width="10" height="10" viewBox="0 0 10 10" fill="none">
                    <path d="M2 3.5L5 6.5L8 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
            <input type="text" class="project-name" value="Untitled Project" id="project-name"
                aria-label="Project Name">
        </div>
    </header>

    <!-- Project Menu Dropdown -->
    <div class="dropdown-menu" id="project-menu" style="display: none;">
        <button class="menu-item" data-action="new-project">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>New Project</span>
            <span class="shortcut">Cmd+N</span>
        </button>
        <button class="menu-item" data-action="recent-projects">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>Recent Projects</span>
        </button>
        <div class="menu-separator"></div>
        <button class="menu-item" data-action="undo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 7v6h6"></path>
                <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
            </svg>
            <span>Undo</span>
            <span class="shortcut">Cmd+Z</span>
        </button>
        <button class="menu-item" data-action="redo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 7v6h-6"></path>
                <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"></path>
            </svg>
            <span>Redo</span>
            <span class="shortcut">Cmd+Shift+Z</span>
        </button>
        <div class="menu-separator"></div>
        <label class="menu-item checkbox-item">
            <input type="checkbox" id="toggle-pixel-grid">
            <span>Pixel Grid</span>
        </label>
        <label class="menu-item checkbox-item">
            <input type="checkbox" id="toggle-rulers">
            <span>Rulers</span>
        </label>
        <label class="menu-item checkbox-item">
            <input type="checkbox" id="toggle-auto-snap" checked>
            <span>Auto Snap</span>
        </label>
        <div class="menu-separator"></div>
        <button class="menu-item danger" data-action="move-to-trash">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            <span>Move to Trash</span>
        </button>
    </div>

    <!-- Top Right Controls (Embedded in Canvas) -->
    <div class="header-right">
        <button class="language-text-btn" id="language-btn" aria-label="Language">
            <span id="language-display">English</span>
        </button>
        <button class="icon-btn" aria-label="Notifications">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
            </svg>
        </button>
        <button class="user-avatar" aria-label="User menu">
            <img src="assets/images/avatar.png" alt="User">
        </button>
    </div>

    <!-- Left Sidebar (Continuous Container) -->
    <aside class="left-sidebar">
        <!-- Primary Actions -->
        <button class="sidebar-btn" data-action="inspiration" title="Inspiration">
            <img src="assets/images/Inspiration.svg" alt="">
        </button>
        <button class="sidebar-btn" data-action="elements" title="Elements">
            <img src="assets/images/Elements.svg" alt="">
        </button>
        <button class="sidebar-btn" data-action="brand" title="Brand Kit">
            <img src="assets/images/Brand kit.svg" alt="">
        </button>
        <button class="sidebar-btn" data-action="cloud" title="Cloud">
            <img src="assets/images/space.svg" alt="">
        </button>
        <div class="sidebar-separator"></div>
        <button class="sidebar-btn" data-action="layers" title="Layers">
            <img src="assets/images/Layers.svg" alt="">
        </button>
    </aside>

    <!-- Inspiration Panel (Floating, next to left sidebar) -->
    <div id="inspiration-panel" class="inspiration-panel hidden">
        <!-- Top Bar: Title + Collapse -->
        <div class="insp-top-bar">
            <span class="insp-title">Inspiration</span>
            <button class="insp-collapse-btn" id="insp-collapse-btn" title="Collapse">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" />
                    <line x1="9" y1="3" x2="9" y2="21" />
                </svg>
            </button>
        </div>

        <!-- Search Bar -->
        <div class="insp-search-wrap">
            <svg class="insp-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
            <!-- AI Intent Icon (shown when analyzing) -->
            <svg class="insp-intent-icon hidden" id="insp-intent-icon" width="16" height="16" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" stroke-dasharray="60" stroke-dashoffset="15" />
            </svg>
            <input type="text" id="insp-search" class="insp-search" placeholder="Search inspiration...">
            <button class="insp-search-clear hidden" id="insp-search-clear">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
        </div>

        <!-- Category Tabs -->
        <div class="insp-category-tabs" id="insp-category-tabs">
            <button class="insp-cat active" data-category="all">All</button>
            <button class="insp-cat" data-category="social">Social Media</button>
            <button class="insp-cat" data-category="effects">Effects</button>
            <button class="insp-cat" data-category="posters">Posters</button>
            <button class="insp-cat" data-category="post">Post</button>
        </div>

        <!-- Results Grid -->
        <div class="insp-results" id="insp-results">
            <!-- Recents Section -->
            <div class="insp-recents-section" id="insp-recents-section">
                <div class="insp-recents-header">
                    <span class="insp-recents-title">Recents</span>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6" />
                    </svg>
                </div>
                <div class="insp-recents-scroll" id="insp-recents-scroll">
                    <!-- Recent items will be populated dynamically -->
                </div>
            </div>

            <div class="insp-loading hidden" id="insp-loading">
                <div class="insp-spinner"></div>
            </div>
            <div class="insp-empty hidden" id="insp-empty">
                <p>No results found</p>
            </div>
            <div class="insp-grid" id="insp-grid"></div>
            <div class="insp-load-more hidden" id="insp-load-more">
                <button class="insp-load-more-btn">Load more</button>
            </div>
        </div>
    </div>

    <!-- Bottom Left - Zoom Controls -->
    <div class="zoom-controls">
        <button class="zoom-dropdown-btn" id="zoom-dropdown-btn" aria-label="Zoom level">
            <span id="zoom-display">20%</span>
            <svg class="dropdown-arrow-small" width="10" height="10" viewBox="0 0 10 10" fill="none">
                <path d="M2 3.5L5 6.5L8 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
    </div>

    <!-- Zoom Dropdown Menu -->
    <div class="zoom-menu hidden" id="zoom-menu">
        <button class="menu-item" data-zoom-action="in">
            <span>Zoom in</span>
            <span class="shortcut"><kbd>⇧</kbd><kbd>+</kbd></span>
        </button>
        <button class="menu-item" data-zoom-action="out">
            <span>Zoom out</span>
            <span class="shortcut"><kbd>⇧</kbd><kbd>-</kbd></span>
        </button>
        <button class="menu-item" data-zoom-action="fit">
            <span>Zoom to fit</span>
            <span class="shortcut"><kbd>⇧</kbd><kbd>F</kbd></span>
        </button>
        <button class="menu-item" data-zoom="0.5">
            <span>Zoom to 50%</span>
            <span class="shortcut"><kbd>⇧</kbd><kbd>0</kbd></span>
        </button>
        <button class="menu-item" data-zoom="1.0">
            <span>Zoom to 100%</span>
            <span class="shortcut"><kbd>⇧</kbd><kbd>1</kbd></span>
        </button>
        <button class="menu-item" data-zoom="2.0">
            <span>Zoom to 200%</span>
            <span class="shortcut"><kbd>⇧</kbd><kbd>2</kbd></span>
        </button>
        <!-- Bottom zoom bar -->
        <div class="zoom-bar">
            <button class="zoom-bar-btn" data-zoom-action="out" aria-label="Zoom out">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
            </button>
            <input class="zoom-bar-input" id="zoom-bar-input" type="text" inputmode="numeric" value="50%">
            <button class="zoom-bar-btn" data-zoom-action="in" aria-label="Zoom in">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Bottom Toolbar (Continuous Container) -->
    <div class="bottom-toolbar">
        <!-- Move Tool (with dropdown indicator for future Hand tool toggle) -->
        <div class="tool-group">
            <button class="tool-btn active" data-tool="move" data-tooltip="Select" data-shortcut="V">
                <img src="assets/images/Cursor.svg" alt="">
            </button>
            <button class="tool-btn" data-tool="hand" data-tooltip="Move" data-shortcut="M">
                <img src="assets/images/Hand.svg" alt="">
            </button>
        </div>

        <div class="tool-separator"></div>

        <!-- Frame (formerly Page) -->
        <button class="tool-btn" data-tool="frame" data-tooltip="Frame" data-shortcut="F">
            <img src="assets/images/Frame.svg" alt="">
        </button>

        <!-- Image -->
        <button class="tool-btn" data-tool="image" data-tooltip="Image" data-shortcut="I">
            <img src="assets/images/Add Image.svg" alt="">
        </button>

        <!-- Text -->
        <button class="tool-btn" data-tool="text" data-tooltip="Text" data-shortcut="T">
            <img src="assets/images/Text.svg" alt="">
        </button>

        <!-- Pencil -->
        <button class="tool-btn" data-tool="pencil" data-tooltip="Pencil" data-shortcut="P">
            <img src="assets/images/Pencil.svg" alt="">
        </button>

        <!-- Shape (Rectangle) -->
        <div class="tool-group">
            <button class="tool-btn" data-tool="rectangle" data-tooltip="Shape" data-shortcut="R">
                <img src="assets/images/Rectangle.svg" alt="">
            </button>
        </div>
    </div>

    <!-- Shape Selector Menu -->
    <div class="shape-menu hidden" id="shape-menu">
        <button class="menu-item" data-shape="rectangle">
            <span>Rectangle</span>
        </button>
        <button class="menu-item" data-shape="ellipse">
            <span>Circle</span>
        </button>
        <button class="menu-item" data-shape="triangle">
            <span>Triangle</span>
        </button>
        <button class="menu-item" data-shape="star">
            <span>Star</span>
        </button>
        <button class="menu-item" data-shape="line">
            <span>Line</span>
        </button>
    </div>

    </div>

    <!-- Frame Floating Action Bar -->
    <div id="frame-action-bar" class="floating-toolbar hidden">
        <div class="toolbar-group">
            <select id="frame-ratio" class="toolbar-select">
                <option value="1:1">1:1</option>
                <option value="4:3">4:3</option>
                <option value="3:4">3:4</option>
                <option value="16:9">16:9</option>
                <option value="9:16">9:16</option>
            </select>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" style="position:relative; padding:4px 8px; gap:6px">
                <div id="frame-bg-preview"
                    style="width:16px; height:16px; border-radius:50%; border:1px solid #ddd; background:#fff"></div>
                <span style="font-size:12px; font-weight:500">Background</span>
                <input type="color" id="frame-bg-color" value="#ffffff"
                    style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
            </button>
        </div>
        <div class="toolbar-separator"></div>
        <button id="frame-download-btn" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                style="margin-right:4px">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Download
        </button>
    </div>

    <!-- Generation Panel Template (cloned per selection for multi-instance) -->
    <template id="gen-panel-template">
        <div class="gen-panel hidden">
            <!-- Collapsed state: same capsule as thinking -->
            <div class="gen-collapsed">
                <svg class="gen-sparkle" width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2C12 2 13.5 8.5 12 12C10.5 8.5 12 2 12 2Z M12 22C12 22 10.5 15.5 12 12C13.5 15.5 12 22 12 22Z M2 12C2 12 8.5 10.5 12 12C8.5 13.5 2 12 2 12Z M22 12C22 12 15.5 13.5 12 12C15.5 10.5 22 12 22 12Z"
                        fill="url(#sparkle-grad-col)" />
                    <circle cx="5" cy="5" r="1.2" fill="url(#sparkle-grad-col)" opacity="0.8" />
                    <circle cx="19" cy="5" r="0.9" fill="url(#sparkle-grad-col)" opacity="0.6" />
                    <circle cx="5" cy="19" r="0.9" fill="url(#sparkle-grad-col)" opacity="0.6" />
                    <circle cx="19" cy="19" r="1.2" fill="url(#sparkle-grad-col)" opacity="0.8" />
                    <defs>
                        <linearGradient id="sparkle-grad-col" x1="2" y1="2" x2="22" y2="22">
                            <stop stop-color="#00D4D4" />
                            <stop offset="1" stop-color="#0077EE" />
                        </linearGradient>
                    </defs>
                </svg>
                <span>Enter anything</span>
            </div>

            <!-- Expanded state: full input panel -->
            <div class="gen-expanded">
                <!-- Uploaded Reference Images -->
                <div class="gen-uploaded-images"></div>

                <!-- Prompt Input -->
                <div class="gen-input-area">
                    <div class="gen-input-editor" contenteditable="true"
                        data-placeholder="Enter anything"></div>
                </div>

                <!-- Footer: add-btn, model selector, image count, send -->
                <div class="gen-footer">
                    <div class="gen-footer-left">
                        <!-- Image Upload Button -->
                        <button class="gen-add-btn" title="Upload reference image">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                        </button>

                        <!-- Model Selector -->
                        <div class="gen-model-selector">
                            <img src="assets/images/Model.svg" alt="Model" class="model-icon-img">
                            <span class="gen-model-label">Auto</span>
                        </div>

                        <!-- Image Count Selector -->
                        <div class="gen-count-selector">
                            <span class="gen-count-label">1 Image</span>
                            <svg width="10" height="10" viewBox="0 0 10 10" fill="none">
                                <path d="M2 3.5L5 6.5L8 3.5" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </div>
                    </div>
                    <div class="gen-footer-right">
                        <!-- Send Button -->
                        <button class="gen-send-btn" disabled>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <line x1="12" y1="19" x2="12" y2="5" />
                                <polyline points="5 12 12 5 19 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Count menu inside panel (not global) -->
                <div class="gen-count-menu hidden">
                    <button class="menu-item" data-count="1">1 Image</button>
                    <button class="menu-item" data-count="2">2 Images</button>
                    <button class="menu-item" data-count="3">3 Images</button>
                    <button class="menu-item" data-count="4">4 Images</button>
                </div>
            </div>

            <!-- Thinking state: same capsule with different content -->
            <div class="gen-thinking">
                <svg class="gen-sparkle gen-sparkle-spin" width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2C12 2 13.5 8.5 12 12C10.5 8.5 12 2 12 2Z M12 22C12 22 10.5 15.5 12 12C13.5 15.5 12 22 12 22Z M2 12C2 12 8.5 10.5 12 12C8.5 13.5 2 12 2 12Z M22 12C22 12 15.5 13.5 12 12C15.5 10.5 22 12 22 12Z"
                        fill="url(#sparkle-grad-think)" />
                    <circle cx="5" cy="5" r="1.2" fill="url(#sparkle-grad-think)" opacity="0.8" />
                    <circle cx="19" cy="5" r="0.9" fill="url(#sparkle-grad-think)" opacity="0.6" />
                    <circle cx="5" cy="19" r="0.9" fill="url(#sparkle-grad-think)" opacity="0.6" />
                    <circle cx="19" cy="19" r="1.2" fill="url(#sparkle-grad-think)" opacity="0.8" />
                    <defs>
                        <linearGradient id="sparkle-grad-think" x1="2" y1="2" x2="22" y2="22">
                            <stop stop-color="#00D4D4" />
                            <stop offset="1" stop-color="#0077EE" />
                        </linearGradient>
                    </defs>
                </svg>
                <span class="gen-thinking-text">Thinking...</span>
                <button class="gen-stop-btn" title="Stop generation">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                        <rect x="1.5" y="1.5" width="9" height="9" rx="2" />
                    </svg>
                </button>
            </div>
        </div>
    </template>

    <!-- Right Sidebar (Agent, Floating) -->
    <aside class="right-sidebar">
        <div class="agent-panel" id="agent-panel">
            <div class="agent-header">
                <div class="agent-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a10 10 0 1 0 10 10H12V2z" />
                        <path d="M12 12 2.1 11.9" />
                        <path d="M12 12V2.1" />
                    </svg>
                    AI Assistant
                </div>
                <button class="icon-btn" id="close-agent-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="agent-content">
                <div style="color: var(--text-tertiary); text-align: center; margin-top: 40px;">
                    <p>How can I help you design today?</p>
                </div>
            </div>
            <div class="agent-input-area">
                <input type="text" placeholder="Ask AI..."
                    style="width: 100%; border: 1px solid var(--border-color); padding: 8px 12px; border-radius: var(--radius-md); outline: none;">
            </div>
        </div>

        <button class="agent-trigger-btn" id="agent-trigger-btn">
            <span style="color: #4285F4; font-weight: bold; font-size: 16px;">✦</span>
            Chat with Agent
        </button>
    </aside>

    <script src="models.js"></script>
    <script src="canvas-engine.js"></script>
    <script src="canvas.js"></script>
    <script src="canvas-gen.js"></script>
    <script src="canvas-inspiration.js"></script>
</body>

</html>